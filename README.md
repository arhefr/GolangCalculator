# **Содержание**
>  - [**Описание:**](#описание)
>      - [Возможности](#возможности)
>  - [**Инструкция:**](#инструкция)
>      - [Как запустить сервер?](#как-запустить-сервер)
>      - [Как отправлять POST запросы?](#как-отправлять-post-запросы)
>      - [Как запустить тесты?](#как-запустить-тесты)
>  - [**Примеры использования.**](#примеры-использования)
>  - [**Как работает калькулятор?**](#как-работает-калькулятор)

# **Описание**
>[!TIP]
>Это **сервер-калькулятор,** написанный на языке **GO**, принимающий POST-запросы с JSON в body.
>
>## **Возможности**
>Калькулятор поддеживает **любые числа**, а также следующие операторы:
>
> | Оператор | Символ | Пример | Решение | Особенности |
> | -------- | ------ | ------ | ------- | ----------- |
> | Сложение | + | 2 + 2 | 4 | ... |
> | Вычитание | - | 2 -- 2 | 4 | Минус на минус даёт плюс |
> | Умножение | * | -2 * (-2) | 4 | ... |
> | Деление | / | 2 / 2 | 1 | На ноль делить нельзя |
> | Возведение в степень | ^ | 2 ^ 2 | 4 | Поддерживает отрицательные степени |
> | Извлечение корня | ^ | 4^(1/2) | 2 | Чтобы извлечь корень, возведите число в степень (1/n), где n степень корня |
> | Cкобки | ( ) | 2(2) | 4 | Если перед скобкой отсутсвует оператор, то число перед ней умножится на неё |

# **Инструкция**
>[!WARNING]
> + Убедитесь, что вы успешно склонировали репозиторий и у вас установлен Golang версии 1.23.0 или выше
> + Все комманды писать в терминале из папки проекта

>[!IMPORTANT]
>## **Как запустить сервер?**
> + ```shell
>   cd calculator
>   ```
> + ```shell
>   go run cmd/main.go
>   ```
> **Чтобы убедиться в том, что сервер запустился, можно воспользоваться следующим запросом:**
>   ```shell
>   curl localhost:8080/ping
>   ```
> Сервер ответит `pong` со статусом 200.

> [!IMPORTANT]
>## **Как отправлять POST запросы?**
>+ Сервер принимает запросы по адресу:
>   ```shell
>   http://localhost:8080/api/v1/calculate
>   ```
>+ В запросе, JSON должен быть следующего вида:
>   ```shell
>   {\"expression\":\"2+2\"}
>   ```
>   
>### Пример запроса:
>```shell
>curl -X POST -H "Content-type:application/json" --data "{\"expression\":\"2+2\"}" http://localhost:8080/api/v1/calculate
>```

> [!IMPORTANT]
>## **Как запустить тесты?**
> + ```shell
>   cd ..
>   ```
> + ```shell
>   cd calculator/calc
>   ```
> + ```shell
>   go test
>   ```

# **Примеры использования**
>[!NOTE]
>**Взависимости от запроса, сервер может вернуть различные сообщения и статусы:**
>
> | Статус | Запрос | Ответ сервера | Причина |
> | ---- | --------- | ------ | ------ |
> | **200** | `curl -X POST -H "Content-type:application/json" --data "{\"expression\":\"2+2\"}" http://localhost:8080/api/v1/calculate` | `{"result": 6}` | Корректный запрос |
> | **405** | `curl localhost:8080/api/v1/calculate?expression="2+2"` | `{"error": "Method is not allowed"}` | Неккоректный тип запроса
> | **422** | `curl -X POST -H "Content-type:application/json" --data "{\"expression\":\"2+\"}" http://localhost:8080/api/v1/calculate` | `{"error": "Expression is not valid"}` | Неккоректное математическое выражение
> | **500** | `curl -X POST -H "Content-type:application/json" --data "{\"expression\":\"2+2\"" http://localhost:8080/api/v1/calculate` | `{"error": "Internal server error"}` | Неккоректный JSON или неизвестная ошибка

# **Как работает калькулятор?**
>[!TIP]
>### Давайте разбёрем код на примере **`2+2*(10-8)`**.
>
>\
>С помощью функции [ParserExpression](calculator/internal/pkg/parser/parser.go) извлекаем из математического выражения все числа и операторы, при чём для операторов создан специальный класс:
>```go
>type operator struct {
>	name     string // Тип оператора
>	Index    int    // Его индекс в примере
>	priority int    // Приоритет его выполнения
>}
>```
> функция вернёт: **`[2, 2, 10, 8], [{+ 0 0}, {* 1 1}, {- 2 5}], nil`** список чисел и операторов соответственно. Список операторов будет отсортирован по приоритету с помощью функции [SortOperators](calculator/internal/pkg/operator.go): **`[{- 2 5}, {* 1 1}, {+ 0 0}]`**.
>
>\
> Дальше функция [Calc](calculator/calc/calc.go) будет пошагово делать операции. Возьмём первый оператор: `[{- 2 5}`, с помощью его индекса мы можем получить оперируемые числа:
>```go
>n1, n2 := nums[opIndex], nums[op.Index+1]
>```
>Выполним операцию с помощью функции [MakeOperation](calculator/internal/pkg/operator.go) и заменим оперируемые числа на результат операции, а использованный оператор уберём из списка. Список чисел и операторов станет выглядеть так: `[2, 2, 2], [{* 1 1}, {+ 0 0}]`. Так будет продолжаться до тех пор пока все операции не будут выполнены. Оставшееся число и будет результатом математического выражения.
>
>Так будет выглядеть работа всего калькулятора для математического выражения из примера с самого начала:\
>`[2 2 10 8] [{- 2 5}, {* 1 1}, {+ 0 0}]`\
>`[2 2 2] [{* 1 1} {+ 0 0}]`\
>`[2 4] [{+ 0 0}]`\
>**`[6] []`**\
>Результат это **`6`**.

